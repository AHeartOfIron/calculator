<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demining Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 5px;
        }
        
        .top-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .home-btn {
            width: 45px;
            height: 45px;
            border: 2px solid var(--primary);
            background: var(--bg-secondary);
            color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(255, 0, 64, 0.2);
        }
        
        .home-btn:hover {
            background: var(--primary);
            color: #000;
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(255, 0, 64, 0.4);
        }
        
        .lang-btn {
            width: 40px;
            height: 40px;
            border: 2px solid var(--primary);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(255, 0, 64, 0.2);
        }
        
        .top-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .control-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #ff0040;
            background: #000;
            color: #ff0040;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-family: 'Times New Roman', serif;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(255, 0, 64, 0.2);
        }
        
        .control-btn:hover {
            background: #ff0040;
            color: #000;
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(255, 0, 64, 0.4);
        }
    </style>
</head>
<body>
    <div class="top-controls">
        <a href="index.html" class="control-btn" title="–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é">
            <i class="fas fa-home"></i>
        </a>
        <button class="control-btn" onclick="toggleLanguage()" title="–ó–º—ñ–Ω–∏—Ç–∏ –º–æ–≤—É" id="langBtn">üá∫üá¶</button>
    </div>
    
    <div class="calculator-container">
        <div class="calc-header">
            <h1><i class="fas fa-bomb"></i> <span id="title">Demining Calculator</span></h1>
            <p id="subtitle">–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ —Ä–æ–∑–º—ñ–Ω—É–≤–∞–Ω–Ω—è —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó</p>
        </div>

        <div class="tab-content">
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label" id="distance-label">–í—ñ–¥—Å—Ç–∞–Ω—å –¥–æ –æ–±'—î–∫—Ç–∞ (–∫–º)</label>
                    <input type="number" class="form-control" id="demining-distance" step="0.1" placeholder="0.0">
                </div>
                <div class="form-group">
                    <label class="form-label" id="area-label">–ü–ª–æ—â–∞ —Ä–æ–∑–º—ñ–Ω—É–≤–∞–Ω–Ω—è (–≥–∞)</label>
                    <input type="number" class="form-control" id="demining-area" step="0.1" placeholder="0.0">
                </div>
                <div class="form-group">
                    <label class="form-label" id="complexity-label">–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó</label>
                    <select class="form-control" id="terrain-difficulty">
                        <option value="0" id="complexity-min">–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞</option>
                        <option value="10" id="complexity-easy">–õ–µ–≥–∫–∞</option>
                        <option value="25" id="complexity-medium">–°–µ—Ä–µ–¥–Ω—è</option>
                        <option value="40" id="complexity-hard">–í–∞–∂–∫–∞</option>
                        <option value="50" id="complexity-critical">–ö—Ä–∏—Ç–∏—á–Ω–∞</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" id="slope-label">–ù–∞—Ö–∏–ª —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó (–≥—Ä–∞–¥—É—Å–∏)</label>
                    <select class="form-control" id="slope-angle">
                        <option value="0" id="slope-low">0-15¬∞</option>
                        <option value="10" id="slope-medium">15-40¬∞</option>
                        <option value="30" id="slope-high">40-90¬∞</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" id="depth-label">–ì–ª–∏–±–∏–Ω–∞ —Ä–æ–∑–º—ñ–Ω—É–≤–∞–Ω–Ω—è (—Å–º)</label>
                    <input type="number" class="form-control" id="demining-depth" value="15" min="1" max="200">
                    <small style="color: var(--text-secondary); margin-top: 5px; display: block;" id="depth-note">–°—Ç–∞–Ω–¥–∞—Ä—Ç: 15 —Å–º. –ü–æ–Ω–∞–¥ 15 —Å–º: +3% –∑–∞ –∫–æ–∂–µ–Ω —Å–º</small>
                </div>
                <div class="form-group">
                    <label class="form-label" id="fuel-price-label">–í–∞—Ä—Ç—ñ—Å—Ç—å –ø–∞–ª–∏–≤–∞ (–≥—Ä–Ω/–ª)</label>
                    <input type="number" class="form-control" id="fuel-price" value="65" step="0.1">
                </div>
                <div class="form-group">
                    <label class="form-label" id="fuel-consumption-label">–†–æ–∑—Ö—ñ–¥ –ø–∞–ª–∏–≤–∞ (–ª/100–∫–º)</label>
                    <input type="number" class="form-control" id="fuel-consumption" value="17" step="0.1">
                </div>
                <div class="form-group">
                    <label class="form-label" id="trips-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏—ó–∑–¥—ñ–≤</label>
                    <input type="number" class="form-control" id="trips-count" value="1" min="1">
                    <small style="color: var(--text-secondary); margin-top: 5px; display: block;" id="trips-note">1 –≤–∏—ó–∑–¥ = —Ç—É–¥–∏ —Ç–∞ –Ω–∞–∑–∞–¥ (–ø–æ–¥–≤—ñ–π–Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å)</small>
                </div>
                <div class="form-group">
                    <label class="form-label" id="urgency-label-top">–¢–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å</label>
                    <div class="form-control" style="display: flex; align-items: center;">
                        <input type="checkbox" id="demining-urgent" style="width: 20px; height: 20px; margin: 0 10px 0 0;">
                        <label for="demining-urgent" id="urgency-label" style="color: var(--text-primary); cursor: pointer; margin: 0;">–¢–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å</label>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="calculateDemining()">
                    <i class="fas fa-calculator"></i> <span id="calc-btn">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</span>
                </button>
                <button class="btn btn-secondary" onclick="showCoefficients()">
                    <i class="fas fa-cog"></i> <span id="coeff-btn">–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏</span>
                </button>
                <button class="btn btn-secondary" onclick="openRouteCalculator()">
                    <i class="fas fa-route"></i> <span id="route-btn">–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É</span>
                </button>
                <button class="btn btn-secondary" onclick="exportPDF()" id="exportBtn" style="display: none;">
                    <i class="fas fa-file-pdf"></i> <span id="export-btn">–ï–∫—Å–ø–æ—Ä—Ç PDF</span>
                </button>
            </div>
            
            <div id="demining-result" style="display: none;"></div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let lastCalculation = null;
        
        function generateFormula(area, baseCostPerHa, difficulty, slopeAngle, depth, urgent, totalCost, distance, fuelConsumption, fuelPrice, tripsCount, roadCost) {
            const lang = localStorage.getItem('language') || 'uk';
            const formulas = {
                uk: `–§–æ—Ä–º—É–ª–∞: (${area} –≥–∞ √ó ${baseCostPerHa} –≥—Ä–Ω/–≥–∞) + ${difficulty}% —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å + ${slopeAngle}% –Ω–∞—Ö–∏–ª + ${depth > 15 ? (depth - 15) * 3 : 0}% –≥–ª–∏–±–∏–Ω–∞ + –ø–∞–ª–∏–≤–æ(${distance}–∫–º √ó ${fuelConsumption}/100 √ó ${fuelPrice}–≥—Ä–Ω/–ª √ó 2 √ó ${tripsCount} = ${roadCost.toFixed(2)}–≥—Ä–Ω)${urgent ? ' + 20% —Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å' : ''} = ${totalCost.toFixed(2)} –≥—Ä–Ω`,
                en: `Formula: (${area} ha √ó ${baseCostPerHa} UAH/ha) + ${difficulty}% complexity + ${slopeAngle}% slope + ${depth > 15 ? (depth - 15) * 3 : 0}% depth + fuel(${distance}km √ó ${fuelConsumption}/100 √ó ${fuelPrice}UAH/l √ó 2 √ó ${tripsCount} = ${roadCost.toFixed(2)}UAH)${urgent ? ' + 20% urgency' : ''} = ${totalCost.toFixed(2)} UAH`,
                fr: `Formule: (${area} ha √ó ${baseCostPerHa} UAH/ha) + ${difficulty}% complexit√© + ${slopeAngle}% pente + ${depth > 15 ? (depth - 15) * 3 : 0}% profondeur + carburant(${distance}km √ó ${fuelConsumption}/100 √ó ${fuelPrice}UAH/l √ó 2 √ó ${tripsCount} = ${roadCost.toFixed(2)}UAH)${urgent ? ' + 20% urgence' : ''} = ${totalCost.toFixed(2)} UAH`
            };
            return formulas[lang];
        }
        
        function calculateDemining() {
            const distance = parseFloat(document.getElementById('demining-distance').value) || 0;
            const area = parseFloat(document.getElementById('demining-area').value) || 0;
            const difficulty = parseFloat(document.getElementById('terrain-difficulty').value) || 0;
            const slopeAngle = parseFloat(document.getElementById('slope-angle').value) || 0;
            const depth = parseFloat(document.getElementById('demining-depth').value) || 15;
            const fuelPrice = parseFloat(document.getElementById('fuel-price').value) || 65;
            const fuelConsumption = parseFloat(document.getElementById('fuel-consumption').value) || 17;
            const tripsCount = parseInt(document.getElementById('trips-count').value) || 1;
            const urgent = document.getElementById('demining-urgent').checked;
            
            // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏
            const baseCostPerHa = parseFloat(localStorage.getItem('demining_baseCost')) || 80000;
            const urgencyPercent = parseFloat(localStorage.getItem('demining_urgency')) || 20;
            const depthCostPercent = parseFloat(localStorage.getItem('demining_depthCost')) || 3;
            
            const baseCost = area * baseCostPerHa;
            const difficultyCost = baseCost * (difficulty / 100);
            const slopeCost = baseCost * (slopeAngle / 100);
            const depthCost = depth > 15 ? baseCost * ((depth - 15) * depthCostPercent / 100) : 0;
            const roadCost = distance * (fuelConsumption / 100) * fuelPrice * 2 * tripsCount;
            
            let subtotal = baseCost + difficultyCost + slopeCost + depthCost + roadCost;
            const urgentCost = urgent ? subtotal * (urgencyPercent / 100) : 0;
            const totalCost = subtotal + urgentCost;
            
            const lang = localStorage.getItem('language') || 'uk';
            
            lastCalculation = {
                type: 'Demining',
                distance, area, difficulty, fuelPrice, fuelConsumption, tripsCount, urgent,
                baseCost, roadCost, urgentCost, totalCost,
                timestamp: new Date().toLocaleString(),
                formula: generateFormula(area, baseCostPerHa, difficulty, slopeAngle, depth, urgent, totalCost, distance, fuelConsumption, fuelPrice, tripsCount, roadCost)
            };
            
            const difficultyText = {
                1: '–õ–µ–≥–∫–∞',
                1.5: '–°–µ—Ä–µ–¥–Ω—è', 
                2: '–í–∞–∂–∫–∞'
            };
            const resultTexts = {
                uk: {
                    title: `–í–∞—Ä—Ç—ñ—Å—Ç—å —Ä–æ–∑–º—ñ–Ω—É–≤–∞–Ω–Ω—è: ${totalCost.toFixed(2)} –≥—Ä–Ω`,
                    formula: 'üìä –§–æ—Ä–º—É–ª–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É:',
                    demining: '–†–æ–∑–º—ñ–Ω—É–≤–∞–Ω–Ω—è',
                    road: '–î–æ—Ä–æ–≥–∞',
                    urgency: '–¢–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å',
                    area: '–ü–ª–æ—â–∞',
                    slope: '–ù–∞—Ö–∏–ª',
                    depth: '–ì–ª–∏–±–∏–Ω–∞',
                    distance: '–í—ñ–¥—Å—Ç–∞–Ω—å',
                    currency: '–≥—Ä–Ω',
                    units: { ha: '–≥–∞', cm: '—Å–º', km: '–∫–º' }
                },
                en: {
                    title: `Demining cost: ${totalCost.toFixed(2)} UAH`,
                    formula: 'üìä Calculation formula:',
                    demining: 'Demining',
                    road: 'Transport',
                    urgency: 'Urgency',
                    area: 'Area',
                    slope: 'Slope',
                    depth: 'Depth',
                    distance: 'Distance',
                    currency: 'UAH',
                    units: { ha: 'ha', cm: 'cm', km: 'km' }
                },
                fr: {
                    title: `Co√ªt de d√©minage: ${totalCost.toFixed(2)} UAH`,
                    formula: 'üìä Formule de calcul:',
                    demining: 'D√©minage',
                    road: 'Transport',
                    urgency: 'Urgence',
                    area: 'Zone',
                    slope: 'Pente',
                    depth: 'Profondeur',
                    distance: 'Distance',
                    currency: 'UAH',
                    units: { ha: 'ha', cm: 'cm', km: 'km' }
                }
            };
            
            const t = resultTexts[lang];
            
            document.getElementById('demining-result').innerHTML = `
                <div class="result-card">
                    <div class="result-title">${t.title}</div>
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin: 15px 0; font-family: monospace; font-size: 0.9rem;">
                        <strong>${t.formula}</strong><br>
                        ${lastCalculation.formula}
                    </div>
                    <div class="result-details">
                        <div class="detail-item">
                            <strong>${t.demining} (—Ñ—ñ–Ω–∞–ª—å–Ω–æ)</strong><br>
                            ${(baseCost + difficultyCost + slopeCost + depthCost + urgentCost).toFixed(2)} ${t.currency}
                        </div>
                        <div class="detail-item">
                            <strong>${t.road} (—Ñ—ñ–Ω–∞–ª—å–Ω–æ)</strong><br>
                            ${roadCost.toFixed(2)} ${t.currency}
                        </div>
                        <div class="detail-item">
                            <strong>${t.urgency}</strong><br>
                            ${urgentCost.toFixed(2)} ${t.currency}
                        </div>
                        <div class="detail-item">
                            <strong>${t.area}</strong><br>
                            ${area} ${t.units.ha}
                        </div>
                        <div class="detail-item">
                            <strong>${t.slope}</strong><br>
                            ${slopeAngle}%
                        </div>
                        <div class="detail-item">
                            <strong>${t.depth}</strong><br>
                            ${depth} ${t.units.cm}
                        </div>
                        <div class="detail-item">
                            <strong>${t.distance}</strong><br>
                            ${distance} ${t.units.km}
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('demining-result').style.display = 'block';
            document.getElementById('exportBtn').style.display = 'inline-flex';
        }

        function exportPDF() {
            if (!lastCalculation) {
                const alertTexts = {
                    uk: '–°–ø–æ—á–∞—Ç–∫—É –≤–∏–∫–æ–Ω–∞–π—Ç–µ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫',
                    en: 'Please perform calculation first',
                    fr: 'Veuillez d\'abord effectuer le calcul'
                };
                const lang = localStorage.getItem('language') || 'uk';
                alert(alertTexts[lang] || alertTexts.en);
                return;
            }
            
            const promptTexts = {
                uk: '–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó:',
                en: 'Enter organization name:',
                fr: 'Entrez le nom de l\'organisation:'
            };
            
            const lang = localStorage.getItem('language') || 'uk';
            const orgName = prompt(promptTexts[lang] || promptTexts.en, 'Territory Demining Services');
            if (!orgName) return;
            
            const managerName = prompt('Enter manager name:', 'John Smith');
            if (!managerName) return;
            
            const managerPosition = prompt('Enter position:', 'Director');
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Enable UTF-8 support
            doc.setFont('helvetica');
            doc.setCharSpace(0.1);
            
            // –ü—Ä–æ—Å—Ç–∏–π PDF –±–µ–∑ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö —à—Ä–∏—Ñ—Ç—ñ–≤
            
            // –§–æ–Ω —Ç–∞ —Ä–∞–º–∫–∞
            doc.setFillColor(240, 240, 240);
            doc.rect(0, 0, 210, 297, 'F');
            doc.setDrawColor(200, 0, 0);
            doc.setLineWidth(2);
            doc.rect(10, 10, 190, 277);
            
            // –ó–∞–≥–æ–ª–æ–≤–æ–∫
            doc.setFillColor(200, 0, 0);
            doc.rect(15, 15, 180, 25, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            const pdfTexts = {
                uk: {
                    title: 'COMMERCIAL PROPOSAL',
                    date: 'Date:',
                    proposal: 'Proposal No:',
                    params: 'PROJECT PARAMETERS:',
                    area: 'Demining area:',
                    distance: 'Distance to object:',
                    complexity: 'Territory complexity:',
                    trips: 'Number of trips:',
                    urgency: 'Urgency:',
                    yes: 'Yes',
                    no: 'No',
                    cost: 'COST CALCULATION:',
                    service: 'Service Description',
                    price: 'Cost (UAH)',
                    demining: 'Main demining operations',
                    transport: 'Logistics and transport',
                    total: 'TOTAL COST:',
                    valid: 'This proposal is valid for 30 days',
                    manager: 'Project Manager:',
                    signature: 'Signature:',
                    currency: 'UAH'
                },
                en: {
                    title: 'COMMERCIAL PROPOSAL',
                    date: 'Date:',
                    proposal: 'Proposal No:',
                    params: 'PROJECT PARAMETERS:',
                    area: 'Demining area:',
                    distance: 'Distance to object:',
                    complexity: 'Territory complexity:',
                    trips: 'Number of trips:',
                    urgency: 'Urgency:',
                    yes: 'Yes',
                    no: 'No',
                    cost: 'COST CALCULATION:',
                    service: 'Service Description',
                    price: 'Cost (UAH)',
                    demining: 'Main demining operations',
                    transport: 'Logistics and transport',
                    total: 'TOTAL COST:',
                    valid: 'This proposal is valid for 30 days',
                    manager: 'Project Manager:',
                    signature: 'Signature:',
                    currency: 'UAH'
                },
                fr: {
                    title: 'PROPOSITION COMMERCIALE',
                    date: 'Date:',
                    proposal: 'Proposition No:',
                    params: 'PARAM√àTRES DU PROJET:',
                    area: 'Zone de d√©minage:',
                    distance: 'Distance √† l\'objet:',
                    complexity: 'Complexit√© du territoire:',
                    trips: 'Nombre de voyages:',
                    urgency: 'Urgence:',
                    yes: 'Oui',
                    no: 'Non',
                    cost: 'CALCUL DU CO√õT:',
                    service: 'Description du service',
                    price: 'Co√ªt (UAH)',
                    demining: 'Op√©rations principales de d√©minage',
                    transport: 'Logistique et transport',
                    total: 'CO√õT TOTAL:',
                    valid: 'Cette proposition est valide pendant 30 jours',
                    manager: 'Chef de projet:',
                    signature: 'Signature:',
                    currency: 'UAH'
                }
            };
            
            const t = pdfTexts[lang];
            
            doc.text(t.title, 105, 30, { align: 'center' });
            doc.setFontSize(14);
            doc.text(orgName, 105, 35, { align: 'center' });
            
            // –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ–º–ø–∞–Ω—ñ—é
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text(t.date + ' ' + lastCalculation.timestamp, 20, 55);
            doc.text(t.proposal + ' DM-' + Date.now().toString().slice(-6), 120, 55);
            
            // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ä–æ–±–æ—Ç
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text(t.params, 20, 75);
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            let y = 85;
            doc.text(`${t.area} ${lastCalculation.area} ha`, 25, y);
            y += 8;
            doc.text(`${t.distance} ${lastCalculation.distance} km`, 25, y);
            y += 8;
            doc.text(`${t.complexity} ${lastCalculation.difficulty}%`, 25, y);
            y += 8;
            doc.text(`${t.trips} ${lastCalculation.tripsCount}`, 25, y);
            y += 8;
            doc.text(`${t.urgency} ${lastCalculation.urgent ? t.yes : t.no}`, 25, y);
            
            // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ
            y += 20;
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text('COST CALCULATION:', 20, y);
            
            // –¢–∞–±–ª–∏—Ü—è
            y += 10;
            doc.setDrawColor(0, 0, 0);
            doc.setLineWidth(0.5);
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ
            doc.setFillColor(230, 230, 230);
            doc.rect(20, y, 120, 8, 'FD');
            doc.rect(140, y, 50, 8, 'FD');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(9);
            doc.text('Service Description', 25, y + 5);
            doc.text('Cost (UAH)', 145, y + 5);
            
            // –†—è–¥–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ
            y += 8;
            doc.setFont('helvetica', 'normal');
            const rows = [];
            if (lastCalculation.baseCost > 0) {
                rows.push([t.demining, lastCalculation.baseCost.toFixed(2)]);
            }
            if (lastCalculation.roadCost > 0) {
                rows.push([t.transport, lastCalculation.roadCost.toFixed(2)]);
            }
            if (lastCalculation.urgentCost > 0) {
                rows.push(['Urgency surcharge', lastCalculation.urgentCost.toFixed(2)]);
            }
            
            rows.forEach(row => {
                doc.rect(20, y, 120, 8, 'D');
                doc.rect(140, y, 50, 8, 'D');
                doc.text(row[0], 25, y + 5);
                doc.text(row[1], 165, y + 5, { align: 'right' });
                y += 8;
            });
            
            // –ü—ñ–¥—Å—É–º–æ–∫
            doc.setFillColor(200, 0, 0);
            doc.rect(20, y, 170, 10, 'FD');
            doc.setTextColor(255, 255, 255);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text(t.total, 25, y + 7);
            doc.text(lastCalculation.totalCost.toFixed(2) + ' ' + t.currency, 165, y + 7, { align: 'right' });
            
            // –ü—ñ–¥–ø–∏—Å
            y += 30;
            doc.setTextColor(0, 0, 0);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.text(t.valid, 20, y);
            y += 20;
            doc.text(`${managerPosition} ${orgName}: ${managerName}`, 20, y);
            doc.text(t.signature + ' ________________', 120, y);
            
            doc.save(`Demining_Proposal_${new Date().toISOString().split('T')[0]}.pdf`);
        }
        
        // Theme handling
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme || 'dark');
        }
        
        // Theme handling
        function applyTheme(theme) {
            // –ù–æ–≤–∏–π –¥–∏–∑–∞–π–Ω –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —á–µ—Ä–≤–æ–Ω—ñ –∞–∫—Ü–µ–Ω—Ç–∏
        }
        
        // Listen for theme changes
        window.addEventListener('message', function(event) {
            if (event.data.type === 'themeChange') {
                applyTheme(event.data.theme);
            }
        });
        
        const translations = {
            uk: {
                'title': 'Demining Calculator',
                'subtitle': '–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ —Ä–æ–∑–º—ñ–Ω—É–≤–∞–Ω–Ω—è —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó',
                'distance-label': '–í—ñ–¥—Å—Ç–∞–Ω—å –¥–æ –æ–±\'—î–∫—Ç–∞ (–∫–º)',
                'area-label': '–ü–ª–æ—â–∞ —Ä–æ–∑–º—ñ–Ω—É–≤–∞–Ω–Ω—è (–≥–∞)',
                'complexity-label': '–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó',
                'complexity-min': '–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞',
                'complexity-easy': '–õ–µ–≥–∫–∞',
                'complexity-medium': '–°–µ—Ä–µ–¥–Ω—è',
                'complexity-hard': '–í–∞–∂–∫–∞',
                'complexity-critical': '–ö—Ä–∏—Ç–∏—á–Ω–∞',
                'slope-label': '–ù–∞—Ö–∏–ª —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó (–≥—Ä–∞–¥—É—Å–∏)',
                'depth-label': '–ì–ª–∏–±–∏–Ω–∞ —Ä–æ–∑–º—ñ–Ω—É–≤–∞–Ω–Ω—è (—Å–º)',
                'depth-note': '–°—Ç–∞–Ω–¥–∞—Ä—Ç: 15 —Å–º. –ü–æ–Ω–∞–¥ 15 —Å–º: +3% –∑–∞ –∫–æ–∂–µ–Ω —Å–º',
                'urgency-label': '–¢–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å',
                'fuel-price-label': '–í–∞—Ä—Ç—ñ—Å—Ç—å –ø–∞–ª–∏–≤–∞ (–≥—Ä–Ω/–ª)',
                'fuel-consumption-label': '–†–æ–∑—Ö—ñ–¥ –ø–∞–ª–∏–≤–∞ (–ª/100–∫–º)',
                'trips-label': '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏—ó–∑–¥—ñ–≤',
                'trips-note': '1 –≤–∏—ó–∑–¥ = —Ç—É–¥–∏ —Ç–∞ –Ω–∞–∑–∞–¥ (–ø–æ–¥–≤—ñ–π–Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å)',
                'calc-btn': '–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏',
                'coeff-btn': '–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏',
                'route-btn': '–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É',
                'export-btn': '–ï–∫—Å–ø–æ—Ä—Ç PDF',
                'close-btn': '–ó–∞–∫—Ä–∏—Ç–∏',
                'urgency-label-top': '–¢–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å',
                'urgency-label': '–¢–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å'
            },
            en: {
                'title': 'Demining Calculator',
                'subtitle': 'Territory demining cost calculation',
                'distance-label': 'Distance to object (km)',
                'area-label': 'Demining area (ha)',
                'complexity-label': 'Territory complexity',
                'complexity-min': 'Minimal',
                'complexity-easy': 'Easy',
                'complexity-medium': 'Medium',
                'complexity-hard': 'Hard',
                'complexity-critical': 'Critical',
                'slope-label': 'Territory slope (degrees)',
                'depth-label': 'Demining depth (cm)',
                'depth-note': 'Standard: 15 cm. Over 15 cm: +3% per cm',
                'urgency-label': 'Urgency',
                'fuel-price-label': 'Fuel price (UAH/l)',
                'fuel-consumption-label': 'Fuel consumption (l/100km)',
                'trips-label': 'Number of trips',
                'trips-note': '1 trip = there and back (double distance)',
                'calc-btn': 'Calculate',
                'coeff-btn': 'Coefficients',
                'route-btn': 'Route Calculator',
                'export-btn': 'Export PDF',
                'close-btn': 'Close',
                'urgency-label-top': 'Urgency',
                'urgency-label': 'Urgency'
            },
            fr: {
                'title': 'Calculatrice de D√©minage',
                'subtitle': 'Calcul du co√ªt de d√©minage de territoire',
                'distance-label': 'Distance √† l\'objet (km)',
                'area-label': 'Zone de d√©minage (ha)',
                'complexity-label': 'Complexit√© du territoire',
                'complexity-min': 'Minimale',
                'complexity-easy': 'Facile',
                'complexity-medium': 'Moyenne',
                'complexity-hard': 'Difficile',
                'complexity-critical': 'Critique',
                'slope-label': 'Pente du territoire (degr√©s)',
                'depth-label': 'Profondeur de d√©minage (cm)',
                'depth-note': 'Standard: 15 cm. Plus de 15 cm: +3% par cm',
                'urgency-label': 'Urgence',
                'fuel-price-label': 'Prix du carburant (UAH/l)',
                'fuel-consumption-label': 'Consommation de carburant (l/100km)',
                'trips-label': 'Nombre de voyages',
                'trips-note': '1 voyage = aller-retour (double distance)',
                'calc-btn': 'Calculer',
                'coeff-btn': 'Coefficients',
                'route-btn': 'Calculateur d\'Itin√©raire',
                'export-btn': 'Exporter PDF',
                'close-btn': 'Fermer',
                'urgency-label-top': 'Urgence',
                'urgency-label': 'Urgence'
            }
        };

        function setLanguage(lang) {
            const translation = translations[lang];
            for (const [key, value] of Object.entries(translation)) {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = value;
                }
            }
            // Update data-translate elements
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translation[key]) {
                    el.textContent = translation[key];
                }
            });
            localStorage.setItem('language', lang);
            updateLanguageButton(lang);
        }
        
        function toggleLanguage() {
            const currentLang = localStorage.getItem('language') || 'uk';
            const languages = ['uk', 'en', 'fr'];
            const currentIndex = languages.indexOf(currentLang);
            const nextIndex = (currentIndex + 1) % languages.length;
            setLanguage(languages[nextIndex]);
        }
        
        function updateLanguageButton(lang) {
            const flags = { uk: 'üá∫üá¶', en: 'üá∫üá∏', fr: 'üá´üá∑' };
            const btn = document.getElementById('langBtn');
            if (btn) btn.textContent = flags[lang] || flags.uk;
        }

        document.addEventListener('DOMContentLoaded', function() {
            const savedLang = localStorage.getItem('language') || 'uk';
            setLanguage(savedLang);
            
            // Load saved values
            const savedDistance = localStorage.getItem('demining_distance');
            const savedArea = localStorage.getItem('demining_area');
            const savedFuelPrice = localStorage.getItem('demining_fuelPrice');
            const savedFuelConsumption = localStorage.getItem('demining_fuelConsumption');
            const savedTrips = localStorage.getItem('demining_trips');
            const savedDepth = localStorage.getItem('demining_depth');
            
            if (savedDistance) document.getElementById('demining-distance').value = savedDistance;
            if (savedArea) document.getElementById('demining-area').value = savedArea;
            if (savedFuelPrice) document.getElementById('fuel-price').value = savedFuelPrice;
            if (savedFuelConsumption) document.getElementById('fuel-consumption').value = savedFuelConsumption;
            if (savedTrips) document.getElementById('trips-count').value = savedTrips;
            if (savedDepth) document.getElementById('demining-depth').value = savedDepth;
            
            // Load saved urgency coefficient
            const savedUrgency = localStorage.getItem('demining_urgency') || '20';
            const urgencyLabel = document.getElementById('urgencyLabel');
            if (urgencyLabel) {
                urgencyLabel.textContent = '–¢–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å';
            }
        });
        
        // Save values when they change
        function saveValues() {
            localStorage.setItem('demining_distance', document.getElementById('demining-distance').value);
            localStorage.setItem('demining_area', document.getElementById('demining-area').value);
            localStorage.setItem('demining_fuelPrice', document.getElementById('fuel-price').value);
            localStorage.setItem('demining_fuelConsumption', document.getElementById('fuel-consumption').value);
            localStorage.setItem('demining_trips', document.getElementById('trips-count').value);
            localStorage.setItem('demining_depth', document.getElementById('demining-depth').value);
        }
        
        // Add event listeners to save on change
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = ['demining-distance', 'demining-area', 'fuel-price', 'fuel-consumption', 'trips-count', 'demining-depth'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', saveValues);
                    element.addEventListener('change', saveValues);
                }
            });
        });
    </script>
    
    <!-- Load route component -->
    <div id="routeComponent"></div>
    <script>
        function showRouteModal(distanceFieldId) {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center;';
            
            modal.innerHTML = `
                <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 15px; padding: 20px; max-width: 500px; width: 90%;">
                    <h3 style="color: var(--text-primary); margin-bottom: 20px;"><i class="fas fa-route"></i> –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--text-primary); display: block; margin-bottom: 5px;">–ü–æ—á–∞—Ç–∫–æ–≤–∞ —Ç–æ—á–∫–∞:</label>
                        <input type="text" id="startPoint" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ö–∏—ó–≤" style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--text-primary); display: block; margin-bottom: 5px;">–ö—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞:</label>
                        <input type="text" id="endPoint" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –õ—å–≤—ñ–≤" style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px;">
                    </div>
                    
                    <div id="additionalPoints"></div>
                    
                    <button onclick="addPoint()" style="width: 100%; padding: 8px; background: transparent; border: 1px dashed var(--border); color: var(--text-primary); border-radius: 5px; cursor: pointer; margin-bottom: 15px;">
                        <i class="fas fa-plus"></i> –î–æ–¥–∞—Ç–∏ —Ç–æ—á–∫—É
                    </button>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="calculateRoute('${distanceFieldId}')" style="flex: 1; padding: 10px; background: var(--primary); color: #000; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-calculator"></i> –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏
                        </button>
                        <button onclick="closeRouteModal()" style="padding: 10px 20px; background: transparent; border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div id="routeResult" style="margin-top: 15px; display: none;"></div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentRouteModal = modal;
        }
        
        function openRouteCalculator() {
            window.targetDistanceField = 'demining-distance';
            
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; align-items: center; justify-content: center;';
            
            const lang = localStorage.getItem('language') || 'uk';
            const closeTexts = { uk: '–ó–∞–∫—Ä–∏—Ç–∏', en: 'Close', fr: 'Fermer' };
            
            modal.innerHTML = `
                <div style="background: var(--bg-primary); border: 2px solid var(--primary); border-radius: 20px; width: 95%; height: 90%; position: relative;">
                    <div style="position: absolute; top: 15px; right: 80px; z-index: 2001;">
                        <button onclick="closeRouteModal()" style="background: var(--gradient); color: #000; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            <i class="fas fa-times"></i> ${closeTexts[lang]}
                        </button>
                    </div>
                    <iframe src="route_calculator_mini.html" style="width: 100%; height: 100%; border: none; border-radius: 20px;" onload="this.contentWindow.postMessage({type: 'setLanguage', language: localStorage.getItem('language') || 'uk'}, '*')"></iframe>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentRouteModal = modal;
        }
        
        function closeRouteModal() {
            if (window.currentRouteModal) {
                window.currentRouteModal.remove();
                window.currentRouteModal = null;
            }
        }
        
        // Listen for route distance from calculator
        window.addEventListener('message', function(event) {
            if (event.data.type === 'routeDistance') {
                if (window.targetDistanceField) {
                    document.getElementById(window.targetDistanceField).value = event.data.distance;
                    window.targetDistanceField = null;
                } else {
                    document.getElementById('demining-distance').value = event.data.distance;
                }
                closeRouteModal();
            }
        });
        
        let pointCounter = 0;
        
        function addPoint() {
            pointCounter++;
            const pointsContainer = document.getElementById('additionalPoints');
            const pointDiv = document.createElement('div');
            pointDiv.style.cssText = 'margin-bottom: 15px; display: flex; gap: 10px; align-items: center;';
            pointDiv.innerHTML = `
                <input type="text" id="point${pointCounter}" placeholder="–ü—Ä–æ–º—ñ–∂–Ω–∞ —Ç–æ—á–∫–∞ ${pointCounter}" style="flex: 1; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px;">
                <button onclick="removePoint(this)" style="padding: 10px; background: transparent; border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            pointsContainer.appendChild(pointDiv);
        }
        
        function removePoint(button) {
            button.parentElement.remove();
        }
        
        function closeRouteModal() {
            if (window.currentRouteModal) {
                window.currentRouteModal.remove();
                window.currentRouteModal = null;
                pointCounter = 0;
            }
        }
        
        function showCoefficients() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; align-items: center; justify-content: center;';
            
            const currentBase = localStorage.getItem('demining_baseCost') || '80000';
            const currentUrgency = localStorage.getItem('demining_urgency') || '20';
            const currentDepthCost = localStorage.getItem('demining_depthCost') || '3';
            
            const difficultyCoeffs = JSON.parse(localStorage.getItem('demining_difficultyCoeffs') || '{"0":"0","10":"10","25":"25","40":"40","50":"50"}');
            const slopeCoeffs = JSON.parse(localStorage.getItem('demining_slopeCoeffs') || '{"0":"0","10":"10","30":"30"}');
            
            const lang = localStorage.getItem('language') || 'uk';
            const coeffTexts = {
                uk: {
                    title: '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ DEMINING',
                    baseCost: '–ë–∞–∑–æ–≤–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å (–≥—Ä–Ω/–≥–∞):',
                    urgency: '–¢–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å (%):',
                    depth: '–ì–ª–∏–±–∏–Ω–∞ (% –∑–∞ —Å–º):',
                    complexityTitle: '–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó (%):',
                    slopeTitle: '–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –Ω–∞—Ö–∏–ª—É —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó (%):',
                    save: '–ó–±–µ—Ä–µ–≥—Ç–∏',
                    close: '–ó–∞–∫—Ä–∏—Ç–∏'
                },
                en: {
                    title: 'DEMINING Coefficients Settings',
                    baseCost: 'Base cost (UAH/ha):',
                    urgency: 'Urgency (%):',
                    depth: 'Depth (% per cm):',
                    complexityTitle: 'Territory complexity coefficients (%):',
                    slopeTitle: 'Territory slope coefficients (%):',
                    save: 'Save',
                    close: 'Close'
                },
                fr: {
                    title: 'Param√®tres des coefficients DEMINING',
                    baseCost: 'Co√ªt de base (UAH/ha):',
                    urgency: 'Urgence (%):',
                    depth: 'Profondeur (% par cm):',
                    complexityTitle: 'Coefficients de complexit√© du territoire (%):',
                    slopeTitle: 'Coefficients de pente du territoire (%):',
                    save: 'Sauvegarder',
                    close: 'Fermer'
                }
            };
            
            modal.innerHTML = `
                <div style="background: var(--bg-secondary); border: 2px solid var(--primary); border-radius: 20px; padding: 30px; max-width: 800px; width: 95%; color: var(--text-primary); max-height: 90vh; overflow-y: auto;">
                    <h3 style="color: var(--primary); margin-bottom: 20px; text-align: center;"><i class="fas fa-cog"></i> ${coeffTexts[lang].title}</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div>
                            <label style="color: var(--text-primary); display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem;">${coeffTexts[lang].baseCost}</label>
                            <input type="number" id="baseCostCoeff" value="${currentBase}" style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; font-size: 0.9rem;">
                        </div>
                        <div>
                            <label style="color: var(--text-primary); display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem;">${coeffTexts[lang].urgency}</label>
                            <input type="number" id="urgencyCoeff" value="${currentUrgency}" style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; font-size: 0.9rem;">
                        </div>
                        <div>
                            <label style="color: var(--text-primary); display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem;">${coeffTexts[lang].depth}</label>
                            <input type="number" id="depthCostCoeff" value="${currentDepthCost}" style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; font-size: 0.9rem;">
                        </div>
                    </div>
                    
                    <h4 style="color: var(--primary); margin: 20px 0 10px 0; font-size: 1.1rem;">${coeffTexts[lang].complexityTitle}</h4>
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px;">
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 5px; font-size: 0.8rem;">–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞:</label>
                            <input type="number" id="difficultyMin" value="${difficultyCoeffs[0]}" style="width: 100%; padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; font-size: 0.8rem;">
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 5px; font-size: 0.8rem;">–õ–µ–≥–∫–∞:</label>
                            <input type="number" id="difficultyEasy" value="${difficultyCoeffs[10]}" style="width: 100%; padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; font-size: 0.8rem;">
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 5px; font-size: 0.8rem;">–°–µ—Ä–µ–¥–Ω—è:</label>
                            <input type="number" id="difficultyMedium" value="${difficultyCoeffs[25]}" style="width: 100%; padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; font-size: 0.8rem;">
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 5px; font-size: 0.8rem;">–í–∞–∂–∫–∞:</label>
                            <input type="number" id="difficultyHard" value="${difficultyCoeffs[40]}" style="width: 100%; padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; font-size: 0.8rem;">
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 5px; font-size: 0.8rem;">–ö—Ä–∏—Ç–∏—á–Ω–∞:</label>
                            <input type="number" id="difficultyCritical" value="${difficultyCoeffs[50]}" style="width: 100%; padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; font-size: 0.8rem;">
                        </div>
                    </div>
                    
                    <h4 style="color: var(--primary); margin: 20px 0 10px 0; font-size: 1.1rem;">${coeffTexts[lang].slopeTitle}</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 5px; font-size: 0.9rem;">0-15¬∞:</label>
                            <input type="number" id="slopeFlat" value="${slopeCoeffs[0]}" style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; font-size: 0.9rem;">
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 5px; font-size: 0.9rem;">15-40¬∞:</label>
                            <input type="number" id="slopeMedium" value="${slopeCoeffs[10]}" style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; font-size: 0.9rem;">
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 5px; font-size: 0.9rem;">40-90¬∞:</label>
                            <input type="number" id="slopeSteep" value="${slopeCoeffs[30]}" style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px; font-size: 0.9rem;">
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                        <button onclick="saveDeminingCoefficients()" class="btn btn-primary" style="flex: 1; padding: 12px; background: var(--gradient); color: #000; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-family: 'Times New Roman', serif;">
                            <i class="fas fa-save"></i> ${coeffTexts[lang].save}
                        </button>
                        <button onclick="closeCoefficientsModal()" class="btn btn-secondary" style="padding: 12px 20px; background: transparent; border: 2px solid var(--primary); color: var(--primary); border-radius: 10px; cursor: pointer; font-weight: bold; font-family: 'Times New Roman', serif;">
                            <i class="fas fa-times"></i> ${coeffTexts[lang].close}
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentCoeffModal = modal;
        }
        
        function saveDeminingCoefficients() {
            // –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏
            const baseCost = document.getElementById('baseCostCoeff').value;
            const urgency = document.getElementById('urgencyCoeff').value;
            const depthCost = document.getElementById('depthCostCoeff').value;
            
            // –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ
            const difficultyCoeffs = {
                0: document.getElementById('difficultyMin').value,
                10: document.getElementById('difficultyEasy').value,
                25: document.getElementById('difficultyMedium').value,
                40: document.getElementById('difficultyHard').value,
                50: document.getElementById('difficultyCritical').value
            };
            
            // –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –Ω–∞—Ö–∏–ª—É
            const slopeCoeffs = {
                0: document.getElementById('slopeFlat').value,
                10: document.getElementById('slopeMedium').value,
                30: document.getElementById('slopeSteep').value
            };
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—Å–µ
            localStorage.setItem('demining_baseCost', baseCost);
            localStorage.setItem('demining_urgency', urgency);
            localStorage.setItem('demining_depthCost', depthCost);
            localStorage.setItem('demining_difficultyCoeffs', JSON.stringify(difficultyCoeffs));
            localStorage.setItem('demining_slopeCoeffs', JSON.stringify(slopeCoeffs));
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –ø—ñ–¥–ø–∏—Å —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ—Å—Ç—ñ
            const urgencyLabel = document.getElementById('urgencyLabel');
            if (urgencyLabel) {
                urgencyLabel.textContent = '–¢–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å';
            }
            
            alert('–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
            closeCoefficientsModal();
        }
        
        function closeCoefficientsModal() {
            if (window.currentCoeffModal) {
                window.currentCoeffModal.remove();
                window.currentCoeffModal = null;
            }
        }
    </script>
</body>
</html>